<!DOCTYPE HTML>
<html lang="fi">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="chatbot_UI_tyyli.css">
        <title>TUNIBot</title>
        <script src="https://unpkg.com/rivescript@latest/dist/rivescript.min.js"></script>
        <script
			  src="https://code.jquery.com/jquery-3.3.1.js"
			  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
			  crossorigin="anonymous">	
		</script>
    </head>
    <body>
        <div id="chatbot_frame">
            <div id="banner">
                <p id="banner_text">TUNIBot Prototype</p>
            </div>
            <div id="chatbot_contentpane" style="overflow-y:auto;">
                <table id="chat_content">

                </table>
            </div>
            <div id="textfield_frame">
                <input id="input_field" type="search" placeholder="Type your message...">
                <button id="submit_button" onclick="submitClicked()">Submit</button>
            </div>

        </div>

        <script type="text/javascript">

            var input = document.getElementById("input_field");
            input.addEventListener("keyup", function(event) {
                event.preventDefault();
                if(event.keyCode === 13) {
                    document.getElementById("submit_button").click();
                }
            });

            function submitClicked()
            {

                var text_value = document.getElementById("input_field").value;

                $(document).ready(function()
                {
	                $("#submit_button").click(function(){
					    $.post("http://localhost:8080/msg",
					    {
					        "query": text_value
					    },
					    function(data, status){
					        alert("Data: " + data + "\nStatus: " + status);
					    });
					}); 
				});

                var table = document.getElementById("chat_content");
                var row = table.insertRow(-1);
                var cell = row.insertCell(0);
                var child = document.createElement("div");


                child.textContent = "You said: " + text_value;
                cell.appendChild(child);
                chat();
            }

            let bot = new RiveScript({utf8: true});

			bot.loadFile("brain.rive").then(brainReady).catch(brainError);

			function brainReady()
			{
				console.log("Chatbot ready!");
				bot.sortReplies();
			}

			function brainError()
			{
				console.log("Brain error!");
			}

			function chat()
			{
				let user_input = document.getElementById("input_field").value;
				let reply = bot.reply("local-user", user_input).then( function(reply) 
				{
					console.log(reply);
					var text_value = reply;

               		var table = document.getElementById("chat_content");
               		var row = table.insertRow(-1);
               		var cell = row.insertCell(0);
               		var child = document.createElement("div");


               		child.textContent = "Bot says: " + text_value;
               		cell.appendChild(child);
               		document.getElementById("input_field").value = '';
		    	});
			}

        </script>    
    </body>
</html>
